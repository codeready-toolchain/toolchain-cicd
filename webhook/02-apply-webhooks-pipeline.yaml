apiVersion: tekton.dev/v1alpha1
kind: Pipeline
metadata:
  name: apply-webhooks
spec:
  params:
  - name: external-sync-domain
    description: The external domain for the sync EventListener
  - name: external-toolchain-cd-domain
    description: The external domain for the toolchain-cd EventListener
  - name: toolchain-cd-projects
    description: List of projects to be used for CD flow
  - name: only-list
    description: If the webhooks should be only listed to test the token

  tasks:
  - name: apply-toolchain-cd-webhook
    taskRef:
      name: create-or-update-webhook
    params:
    - name: GitHubOrg
      value: "MatousJobanek"
    - name: GitHubRepos
      value: "toolchain-cicd"
    - name: ExternalDomain
      value: $(params.external-sync-domain)
    - name: WebhookEvents
      value: '[\"push\",\"pull_request\"]'
    - name: only-list
      value: $(params.only-list)

  - name: apply-toolchain-cd-repo-webhook
    taskRef:
      name: create-or-update-webhook
    params:
    - name: GitHubOrg
      value: "MatousJobanek"
    - name: GitHubRepos
      value: $(params.toolchain-cd-projects)
    - name: ExternalDomain
      value: $(params.external-toolchain-cd-domain)
    - name: only-list
      value: $(params.only-list)